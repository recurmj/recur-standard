# RIP-003: Cross-Network Flow Intent

**Author:** M J (Recur Labs)  
**Status:** Final (v1.0 reference)  
**Note:** First formal definition; implementation stable but open to audit feedback.  
**Version:** 0.1  
**Date:** October 2025  
**Depends on:** RIP-001 (Permissioned Pull Objects), RIP-002 (Consent Registry)

---

## Abstract

RIP-003 defines an intent format that describes desired liquidity movement across domains (chains, L2s, custodial venues, treasuries) under explicit consent.  
It does **not** execute the movement; it encodes *what should move, from where, to where, under what limits, by whom, and under what timing / conditions.*

RIP-003 acts as the routing-policy layer for permissioned pull systems — the way a network expresses **target state before execution.**

---

## Motivation

Push-based crypto only reacts after imbalance.  
RIP-001 introduced *pull* (grantee can draw under consent).  
RIP-002 introduced a *registry* of that consent.  
But large systems need coordinated motion:

> “40 M USDC should sit on Chain A, 15 M on Chain B, 5 M on Exchange C — keep it within these caps.”

RIP-003 formalizes this as an on-chain object so off-chain agents and routers can coordinate execution without custody or ambiguity.

---

## Core Concepts

- **FlowIntent**: a signed object describing desired liquidity relocation across domains.  
- **Domains**: abstract identifiers of *where value currently lives / should live* (L1 address, L2 vault, custody account, etc.).  
- **Authorized Actor**: who is allowed to fulfill the intent (e.g., router / mesh agent).  
- **Constraints**: caps, timing windows, and compliance requirements.  
- **Revocation**: grantor can revoke the intent at any time, like a PPO.

---

## Specification

A `FlowIntent` specifies:

- `grantor`  → address (who owns / controls the funds)  
- `executor` → address (authorized router / mesh agent)  
- `srcDomain` → bytes32 (identifier of source location)  
- `dstDomain` → bytes32 (identifier of destination location)  
- `token`     → address (asset being rebalanced)  
- `maxAmount` → uint256 (upper limit authorized to move)  
- `validAfter / validBefore` → uint256 (time window)  
- `nonce`     → bytes32 (uniqueness / replay separator)  
- `metadataHash` → bytes32 (optional off-chain policy / compliance note)

### Data Structure (v0.1)

~~~
struct FlowIntent {
    address grantor;
    address executor;
    bytes32 srcDomain;
    bytes32 dstDomain;
    address token;
    uint256 maxAmount;
    uint256 validAfter;
    uint256 validBefore;
    bytes32 nonce;
    bytes32 metadataHash;
}
~~~

The `FlowIntent` object is intentionally parallel to RIP-001’s Authorization / PPO schema,  
but represents *“relocate between domains”* rather than *“pull from grantor to receiver.”*

---

## Security and Revocation Model

- Executor cannot exceed `maxAmount`.  
- Executor cannot act outside `validAfter / validBefore`.  
- Grantor may revoke the intent at any time through the Consent Registry (RIP-002).  
- Each fulfillment increments `cumulativeUsed` to enforce caps.  
- Revocation instantly invalidates further calls to `fulfillIntent()` or `executeFlow()`.

These guarantees make cross-network execution non-custodial and cryptographically bounded by consent.

---

## Reference Implementation

See `FlowIntentRegistry.sol` and `CrossNetworkRebalancer.sol`.  
RIP-004 builds on these contracts to perform non-custodial rebalancing under verifiable consent.

---

## Narrative Summary

RIP-003 lets systems describe *where liquidity should be — before anything moves.*  
It is the intent layer of Recur’s flow architecture: a universal way to declare target state, enforced by permissioned pull and revocation.

---

© 2025 Recur Labs — Part of the Recur Permissioned-Pull Standard (RIP Series 001–008)
