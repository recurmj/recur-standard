# RIP-005: Flow Channels — Continuous Authorized Pull

**Author:** M J (Recur Labs)  
**Status:** Draft  
**Version:** 0.1  
**Date:** October 2025  
**Depends on:** RIP-001 (Permissioned Pull Standard), RIP-002 (Consent Registry & Events)  

---

## Abstract

RIP-005 defines a rate-limited, continuous pull channel between a **Grantor** and a **Grantee**.  
Instead of a one-time pull (RIP-001), a Flow Channel lets the Grantee **accrue and pull value continuously** (e.g. X units per second) up to a moving allowance, under revocable consent.  
This enables ongoing payments, payroll, streaming settlement, automated debt paydown, and treasury draining; all without custody.

---

## Motivation

Push-based recurring payments require trust, batching, or external scheduling.  
RIP-001 introduced permissioned pull, but still as discrete events.  
RIP-005 extends that model to a *drip-based* flow: value moves continuously without renegotiation per pull, while preserving consent, rate limits, pause, and revocation.

---

## Specification (High-Level)

### Channel Parties
- **grantor:** `address` — source of funds  
- **grantee:** `address` — authorized receiver  

### Asset
- **token:** `address` — ERC-20 compatible  

### Rate Model
- **ratePerSecond:** `uint256` — rate of accrual per second  
- **maxBalance:** `uint256` — hard cap on accrued but unclaimed balance  

### State
- **lastUpdate:** `uint64` — timestamp of last accrual  
- **accrued:** `uint256` — amount currently available to pull  
- **paused:** `bool` — temporarily halted by grantor  
- **revoked:** `bool` — permanently terminated by grantor  

### Actions
- `accrue()` — updates `accrued` based on elapsed time since `lastUpdate`, capped at `maxBalance`; callable by anyone  
- `pull(to, amount)` — grantee claims up to `accrued`; performs `transferFrom(grantor → to)`  
- `pause()` / `resume()` — grantor may pause or resume accrual and pull  
- `revoke()` — grantor ends the channel; no further accrual or pull allowed  

### Security Constraints
- `pull()` MUST respect both pause and revoke flags.  
- `pull()` MUST NOT exceed `accrued`.  
- `accrue()` MUST cap at `maxBalance` even if time elapsed greatly exceeds allowance window.  
- Grantor MUST retain the ability to revoke or pause at any time.  

---

## Revocation

Grantor may revoke or pause at will.  
After revocation, no new accrual builds, and the grantee cannot pull further.

---

## Compliance / Auditability

All parameters (rate, cap, token, grantee) are on-chain, enabling auditors or regulators to prove **maximum outflow exposure** without private agreements or off-chain data.  

Flow Channels SHOULD emit `Accrued` and `Pulled` events mirroring the RIP-002 event schema for consistent indexing and monitoring.

---

## Reference Implementation

See `FlowChannel.sol`.

---

## Narrative Line

RIP-005 upgrades consented pull into continuous flow.  
Money stops being an invoice and becomes a live stream.
